<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Type stability · MetaGraphsNext.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://juliagraphs.org/MetaGraphsNext.jl/dev/tutorial/4_type_stability/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MetaGraphsNext.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../1_basics/">Basics</a></li><li><a class="tocitem" href="../2_graphs/">Graphs.jl  interface</a></li><li><a class="tocitem" href="../3_files/">File storage</a></li><li class="is-active"><a class="tocitem" href>Type stability</a><ul class="internal"><li><a class="tocitem" href="#Constructor-and-access"><span>Constructor and access</span></a></li><li><a class="tocitem" href="#Comparison-with-MetaGraphs.jl"><span>Comparison with MetaGraphs.jl</span></a></li></ul></li><li><a class="tocitem" href="../5_benchmark/">Benchmark</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Type stability</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Type stability</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGraphs/MetaGraphsNext.jl/blob/master/test/tutorial/4_type_stability.jl" title="View on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">View on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Type-stability"><a class="docs-heading-anchor" href="#Type-stability">Type stability</a><a id="Type-stability-1"></a><a class="docs-heading-anchor-permalink" href="#Type-stability" title="Permalink"></a></h1><pre><code class="language-julia hljs">using Graphs
using MetaGraphs: MetaGraphs
using MetaGraphsNext</code></pre><h2 id="Constructor-and-access"><a class="docs-heading-anchor" href="#Constructor-and-access">Constructor and access</a><a id="Constructor-and-access-1"></a><a class="docs-heading-anchor-permalink" href="#Constructor-and-access" title="Permalink"></a></h2><p>In the previous examples, we used a <code>MetaGraph</code> constructor which receives type parameters as keyword arguments. This was done for ease of exposition, but it may impede type inference, and hence reduce performance.</p><pre><code class="language-julia hljs">colors = MetaGraph(
    Graph();  # underlying graph structure
    label_type=Symbol,  # color name
    vertex_data_type=NTuple{3,Int},  # RGB code
    edge_data_type=Symbol,  # result of the addition between two colors
    graph_data=&quot;additive colors&quot;,  # tag for the whole graph
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta graph based on a SimpleGraph{Int64} with vertex labels of type Symbol, vertex metadata of type Tuple{Int64, Int64, Int64}, edge metadata of type Symbol, graph metadata given by &quot;additive colors&quot;, and default weight 1.0</code></pre><p>While casual users probably won&#39;t care, if your goal is performance, you might need to proceed differently.</p><p>Option 1: wrap the constructor in a helper function to trigger constant propagation.</p><pre><code class="language-julia hljs">function colors_constructor()
    return MetaGraph(
        Graph();
        label_type=Symbol,
        vertex_data_type=NTuple{3,Int},
        edge_data_type=Symbol,
        graph_data=&quot;additive colors&quot;,
    )
end

colors_constructor()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta graph based on a SimpleGraph{Int64} with vertex labels of type Symbol, vertex metadata of type Tuple{Int64, Int64, Int64}, edge metadata of type Symbol, graph metadata given by &quot;additive colors&quot;, and default weight 1.0</code></pre><p>Option 2: switch to another constructor that uses positional arguments (be careful with the order!)</p><pre><code class="language-julia hljs">MetaGraph(Graph(), Symbol, NTuple{3,Int}, Symbol, &quot;additive colors&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta graph based on a SimpleGraph{Int64} with vertex labels of type Symbol, vertex metadata of type Tuple{Int64, Int64, Int64}, edge metadata of type Symbol, graph metadata given by &quot;additive colors&quot;, and default weight 1.0</code></pre><p>Option 3: use the constructor for a non-empty graph instead.</p><pre><code class="language-julia hljs">vertices_description = [:red =&gt; (255, 0, 0), :green =&gt; (0, 255, 0), :blue =&gt; (0, 0, 255)]
edges_description = [
    (:red, :green) =&gt; :yellow, (:red, :blue) =&gt; :magenta, (:green, :blue) =&gt; :cyan
]
MetaGraph(cycle_graph(3), vertices_description, edges_description, &quot;additive colors&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta graph based on a SimpleGraph{Int64} with vertex labels of type Symbol, vertex metadata of type Tuple{Int64, Int64, Int64}, edge metadata of type Symbol, graph metadata given by &quot;additive colors&quot;, and default weight 1.0</code></pre><p>Once Julia can infer the full type of the <code>MetaGraph</code>, accessing vertex and edge metadata also becomes type-stable.</p><h2 id="Comparison-with-MetaGraphs.jl"><a class="docs-heading-anchor" href="#Comparison-with-MetaGraphs.jl">Comparison with MetaGraphs.jl</a><a id="Comparison-with-MetaGraphs.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-MetaGraphs.jl" title="Permalink"></a></h2><p>In the older package <a href="https://github.com/JuliaGraphs/MetaGraphs.jl">MetaGraphs.jl</a> that we used as inspiration, data types are not specified in the graph structure. Their choice allows more flexibility and an arbitrary number of attributes which the user does not need to anticipate at construction.</p><pre><code class="language-julia hljs">colors_unstable = MetaGraphs.MetaGraph(cycle_graph(3))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">{3, 3} undirected Int64 metagraph with Float64 weights defined by :weight (default weight 1.0)</code></pre><p>Here is how one would add data and labels to <code>colors_unstable</code>.</p><pre><code class="language-julia hljs">MetaGraphs.set_indexing_prop!(colors_unstable, :label)

MetaGraphs.set_prop!(colors_unstable, :graph_tag, &quot;additive colors&quot;)

MetaGraphs.set_props!(colors_unstable, 1, Dict(:label =&gt; :red, :rgb_code =&gt; (255, 0, 0)))
MetaGraphs.set_props!(colors_unstable, 2, Dict(:label =&gt; :green, :rgb_code =&gt; (0, 255, 0)))
MetaGraphs.set_props!(colors_unstable, 3, Dict(:label =&gt; :blue, :rgb_code =&gt; (0, 0, 255)))

MetaGraphs.set_prop!(colors_unstable, 1, 2, :addition_result, :yellow)
MetaGraphs.set_prop!(colors_unstable, 1, 3, :addition_result, :magenta)
MetaGraphs.set_prop!(colors_unstable, 2, 3, :addition_result, :cyan);</code></pre><p>One can retrieve the vertex index (which we called code) using any indexing property.</p><pre><code class="language-julia hljs">colors_unstable[:green, :label]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2</code></pre><p>Then we can access vertex properties...</p><pre><code class="language-julia hljs">MetaGraphs.get_prop(colors_unstable, 2, :rgb_code)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(0, 255, 0)</code></pre><pre><code class="language-julia hljs">MetaGraphs.props(colors_unstable, 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Any} with 2 entries:
  :rgb_code =&gt; (0, 255, 0)
  :label    =&gt; :green</code></pre><p>... and edge properties.</p><pre><code class="language-julia hljs">MetaGraphs.get_prop(colors_unstable, 2, 3, :addition_result)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">:cyan</code></pre><pre><code class="language-julia hljs">MetaGraphs.props(colors_unstable, 2, 3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Any} with 1 entry:
  :addition_result =&gt; :cyan</code></pre><p>The fact that the outputs of these calls to <code>props</code> are of type <code>Dict{Symbol, Any}</code> is at the root of the problem. It means that if we use their values in any subsequent algorithms, we introduce type instability in our code (due to <code>Any</code>). MetaGraphsNext.jl overcomes this obstacle thanks to a more precise storage method.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_files/">« File storage</a><a class="docs-footer-nextpage" href="../5_benchmark/">Benchmark »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 14 August 2023 08:01">Monday 14 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
